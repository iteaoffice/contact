{% set contactService = contactServiceProxy(zfcUserIdentity()) %}

{% do headTitle().append(translate("txt-profile")) %}
{% do headTitle().append(contactService.parseFullname()) %}

<h1 class="home">{{ translate("txt-hello-%s")|format(zfcUserDisplayName()) }}</h1>

<ul id="tab" class="nav nav-tabs">
    <li class="active"><a href="#profile" data-toggle="tab">{{ translate("txt-profile")|capitalize }}</a></li>
    <li><a href="#organisation" data-toggle="tab">{{ translate("txt-organisation")|capitalize }}</a></li>
    <li><a href="#event" data-toggle="tab">{{ translate("txt-events")|capitalize }}</a></li>
    <li><a href="#updates" data-toggle="tab">{{ translate("txt-updates")|capitalize }}</a></li>
</ul>

<div id="tabContent" class="tab-content">
    <div class="tab-pane fade in active" id="profile">
        <h2>{{ translate("txt-personal-profile") }}</h2>
        <dl class="dl-horizontal">
            <dt>{{ translate("txt-name") }}</dt>
            <dd>{{ contactService.parseFullName() }} ({{ contactService.contact.id }})</dd>
            <dt>{{ translate("txt-email") }}</dt>
            <dd>{{ contactService.contact.email }}</dd>
            <dt>{{ translate("txt-direct-phone") }}</dt>
            <dd>{{ contactService.getDirectPhone() }}</dd>
            <dt>{{ translate("txt-mobile-phone") }}</dt>
            <dd>{{ contactService.getMobilePhone() }}</dd>
            {% if  contactService.getMailAddress() %}
                <dt>{{ translate("txt-postal-address") }}</dt>
                <dd>{{ contactService.getMailAddress().address.address }}</dd>
                <dd>{{ contactService.getMailAddress().address.zipCode }} {{ contactService.getMailAddress().address.city }}</dd>
                <dd>{{ contactService.getMailAddress().address.country|upper }}</dd>
            {% endif %}
            <dt>{{ translate("txt-profile-visibility") }}</dt>
            {% if contactService.contact.profile.visible is not null %}
                <dd>{{ translate(contactService.contact.profile.visible(true)) }}</dd>
            {% else %}
                <dd>{{ translate("txt-no-visibililty-defined") }}</dd>
            {% endif %}
            <dt>{{ translate("txt-expertise") }}</dt>
            <dd>{{ contactService.contact.profile.description }}</dd>
            <dt>{{ translate("txt-community") }}</dt>
            {% for community in contactService.contact.community %}
                {% if loop.first %}<dd>{% endif %}{{ communityLink(community) }}{% if loop.last %}</dd>{% endif %}
            {% else %}
                <dd>{{ translate("txt-no-community-known") }}</dd>
            {% endfor %}
            <dt>{{ translate("txt-open-id") }}</dt>
            {% for openId in contactService.contact.openId %}
                <dd>{{ translate("txt-open-id") }} - {{ openId }}</dd>
            {% else %}
                <dd>{{ translate("txt-no-open-in-known") }}</dd>
            {% endfor %}
        </dl>

        {{ contactLink(contactService.contact,'edit-profile', 'button') }}
        {{ contactLink(contactService.contact,'change-password', 'button') }}

        {% if hasNda %}
            {{ ndaLink(null,'upload', 'button') }}
        {% endif %}
    </div>


    <div class="tab-pane fade in" id="organisation">
        {% set organisationService = contactService.findOrganisationService() %}

        <h2>{{ translate("txt-organisation") }}</h2>
        {% if organisationService %}
            <dl class="dl-horizontal">
                <dt>{{ translate("txt-organisation") }}</dt>
                <dd>{{ organisationService.parseOrganisationWithBranch(contactService.contact.contactOrganisation.branch) }}</dd>
                <dt>{{ translate("txt-organisation-type") }}</dt>
                <dd>{{ organisationService.organisation.type.description }}</dd>
                <dt>{{ translate("txt-country") }}</dt>
                <dd>{{ organisationService.organisation.country }}</dd>
                {% if contactService.contact.department %}
                    <dt>{{ translate("txt-department") }}</dt>
                    <dd>{{ contactService.contact.department }}</dd>
                {% endif %}
                {% if contactService.contact.position %}
                    <dt>{{ translate("txt-position") }}</dt>
                    <dd>{{ contactService.contact.position }}</dd>
                {% endif %}
                <dt>{{ translate("txt-general-description") }}</dt>
                <dd>{{ organisationService.organisation.description|raw }}</dd>
            </dl>
        {% else %}
            {{ ztbalert().info(translate("txt-no-organisation-found-complete-your-profile-to-participate-in-projects"))|raw }}
        {% endif %}
        {{ contactLink(contactService.contact,'edit-profile', 'button') }}
    </div>

    <div class="tab-pane fade in" id="event">
        <h2>{{ translate("txt-events") }}</h2>

        {% include 'event/partial/list/meeting-list' %}
    </div>


    <div class="tab-pane fade in" id="updates">
        <h2>{{ translate("txt-updates") }}</h2>

        <p>{{ translate("txt-updates-explanation") }}</p>

        {% for optIn in contactService.findAll('optIn') %}
            {% include 'contact/partial/optin-button' with {'optIn': optIn} %}
            <br>
        {% endfor %}

    </div>
</div>
